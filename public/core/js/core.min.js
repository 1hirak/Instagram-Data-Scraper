$=jQuery;var $document=$(document),is_online=window.navigator.onLine,htaccess=$.trim($("#htaccess").val()),$btnExportExcel=$("#btnExport"),$loadingContainer=$(".progress-bar"),totalRequestUrl=0,currentMasterIndex=1,currentMasterProgress=0,logInfo=!1,isFilter=!1,is_chart_created=(htaccess=$.trim($("#is_htaccess_enable").val()),!1),navBarForm=$(".form-inline"),booClose=$(".close"),keyContainer=["#digitaslbi"],currentIndex=0,chkOpt=$("input[name='info-toggle']:checked").val(),Config={action:"account",infoFullMin:chkOpt,urlRequest:"includes/AjaxServices.php",userAgentStatus:is_online,btnSearch:"#btnSearch",txtSearch:"#txtSearch",queryFormTemplate:"#query-form-template",accountThumbPopup:"#account-thumbs",searchFormContainer:"#search-form-section",searchFormChartContainer:"#search-form-chart-section",lblCountSearchAccounts:"#CountSearchAccounts .badge.badge-pill",lblCountSearchHashtags:"#CountSearchHashtags .badge.badge-pill",lblSumOfTotalLikes:"#SumOfTotalLikes .badge.badge-pill",lblSumOfTotalComments:"#SumOfTotalComments .badge.badge-pill",lblSumOfTotalShare:"#SumOfTotalShare .badge.badge-pill",lblSumOfTotalPosts:"#SumOfTotalPosts .badge.badge-pill",chartTemplate:"#chart-template",offlineMsg:"Please enable Internet Connection. You are off-line",queryAccounts:1,queryHashtags:1,queryLikes:1,queryComments:1,queryKeywords:1,queryPosts:1,getItem:function(t){return this[t].toString()?(_l("Item found: "+t),this[t].toString()):(_l("Item not found: "+t),!1)},setItem:function(t,e){this[t]&&(_l("Item found and set value: "+t+" : "+e),this[t]=e)}},_l=function(t){!0===logInfo&&console.log(t)};$(document).ajaxError(function(t,e,o,n){errStr="",errStr+='<div class="alert alert-danger alert-dismissable">',errStr+='  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>',errStr+="  <strong>Error in Request: </strong> "+n,errStr+="</div>",$(".error-handling .container-fluid").html(errStr).parent().removeClass("hide")});var stateProgress=function(){_l("currentMasterIndex: "+currentMasterIndex),_l("currentMasterProgress: "+currentMasterProgress)};function fnExcelReport(t){var e=document.getElementById(t),o="<table border='2px'>";for(j=0;j<1;j++)o+="<tr bgcolor='#87AFC6'>"+e.rows[j].innerHTML+"</tr>";for(j=1;j<e.rows.length;j++)o+="<tr>"+e.rows[j].innerHTML+"</tr>";return o=(o=(o=(o+="</table>").replace(/<A[^>]*>|<\/A>/g,"")).replace(/<img[^>]*>/gi,"")).replace(/<input[^>]*>|<\/input>/gi,""),"data:application/vnd.ms-excel, "+encodeURIComponent(o)}var Instagram=function(){this.stateError=!1,this.txtProgressState=0,this.info=[],this.urlInstagram="https://www.instagram.com",this.urlInstagramNext=null,this.InstaJSON=null,this.currentIndex=0,this.currentIndexPost=0,this.isSearchingForNext=!1,this.errorContainer=$(".user-error"),this.infoContainer=$(".user-info"),this.tableWrapper=$("#search-account-table"),this.tableContentWrapper=$("#search-account-table.table-striped tbody"),this.txtIndicator=$(".txt-progress"),this.sendRequestUrl=Config.getItem("urlRequest"),this.infoFullMin=Config.getItem("infoFullMin")};Instagram.prototype.setAccount=function(){var t=this;if(!1===this.isSearchingForNext&&(this.info=[],this.info.Biography=this.InstaJSON.user.biography,this.info.UserName=this.InstaJSON.user.username,this.info.FullName=this.InstaJSON.user.full_name,this.info.Posts=this.InstaJSON.user.media.count,this.info.Followers=this.InstaJSON.user.followed_by.count,this.info.Following=this.InstaJSON.user.follows.count,this.info.AccountHref=this.urlInstagram+"/"+this.InstaJSON.user.username,this.info.Thumbs=[]),"min"!=this.infoFullMin){var e=Math.ceil(this.info.Posts/12);this.eventHandler("Likes & Comments: "+this.currentIndexPost+"/"+e+", "+this.info.FullName),this.txtProgressState=Math.ceil(100*this.currentIndexPost)/e;var o=this.InstaJSON.user.media.nodes,n=[],s=[],i=[],a=0,r=0,l=0;$.each(o,function(e,o){t.info.Thumbs.push({"thumb-src":o.thumbnail_resources[0].src,comments:o.comments.count,likes:o.likes.count}),n.push(o.likes.count),s.push(o.comments.count),i.push(o.video_views?o.video_views:0)}),$.each(n,function(){a+=parseInt(this)||0}),$.each(s,function(){r+=parseInt(this)||0}),$.each(i,function(){l+=parseInt(this)||0}),!1===this.isSearchingForNext?(this.info.TotalLikes=a,this.info.TotalComments=r,this.info.TotalViews=l):(this.info.TotalLikes=parseInt(this.info.TotalLikes)+a,this.info.TotalComments=parseInt(this.info.TotalComments)+r,this.info.TotalViews=parseInt(this.info.TotalViews)+l),!0===this.InstaJSON.user.media.page_info.has_next_page?(this.urlInstagramNext=o[o.length-1].id,this.currentIndexPost+=1,this.isSearchingForNext=!0):(this.currentIndexPost=1,this.isSearchingForNext=!1)}void 0===this.info.TotalLikes&&(this.info.TotalLikes=0),void 0===this.info.TotalComments&&(this.info.TotalComments=0),void 0===this.info.TotalViews&&(this.info.TotalViews=0)},Instagram.prototype.buildViews=function(){var t="";t+='<tr class="info-row">',t+='<td><input class="tbl-chk" type="checkbox"></td>',t+='<td><a target="_blank" href="'+this.info.AccountHref+'">'+this.info.UserName+"</a></td>",t+="<td>"+this.info.Biography+"</td>",t+="<td>"+this.info.Followers+"</td>",t+="<td>"+this.info.Following+"</td>",t+="<td>"+this.info.Posts+"</td>",t+='<td><a href="#" data-toggle="modal" data-target="#thumb-'+this.info.UserName+'">'+this.info.TotalLikes+"</a></td>",t+="<td>"+this.info.TotalComments+"</td>",t+="<td>"+this.info.TotalViews+"</td>",t+="<td>",t+='<a data-placement="top" data-toggle="tooltip" title="Edit">',t+='<button class="btn btn-primary btn-xs" data-title="Edit" data-toggle="modal" data-target="#edit"><span class="glyphicon glyphicon-pencil"></span></button>',t+="</a> ",t+='<a data-placement="top" data-toggle="tooltip" title="Delete">',t+='<button class="btn btn-danger btn-xs" data-title="Delete" data-toggle="modal" data-target="#delete"><span class="glyphicon glyphicon-trash"></span></button>',t+="</a>",t+="</td>",t+="</tr>";var e=$(Config.getItem("accountThumbPopup")).html();return Mustache.parse(e),rendered=Mustache.render(e,{username:this.info.UserName,"thumb-loop":this.info.Thumbs}),this.tableWrapper.after(rendered),t},Instagram.prototype.errorHandler=function(t){this.errorContainer.html(t)},Instagram.prototype.eventHandler=function(t,e){void 0===e?(this.txtIndicator.eq(this.currentIndex).css({width:this.txtProgressState+"%","border-top":"2px solid green"}),this.infoContainer.eq(this.currentIndex).html(t)):(this.txtIndicator.eq(this.currentIndex).css({width:this.txtProgressState+"%","border-top":"2px solid red"}),this.infoContainer.eq(this.currentIndex).removeClass("label-info").addClass(e).html(t))},Instagram.prototype.initNow=function(t,e){var o=this;return e||(e={iUrl:t,request_action:"pull_account"}),$.post(o.sendRequestUrl,e,function(t,e,n){var s=0;if(window._sharedData.error)return o.stateError=!0,o.errorHandler(window._sharedData.error),s=Math.floor(currentMasterIndex/totalRequestUrl*100),currentMasterProgress=s,stateProgress(),currentMasterIndex++,!1;if(o.InstaJSON=window._sharedData.entry_data.ProfilePage.shift(),!0===o.InstaJSON.user.is_private)return o.eventHandler("This is Private account: "+o.InstaJSON.user.full_name,"label-danger"),!1;if(o.stateError=!1,o.setAccount(),!0===o.isSearchingForNext){var i={keyword:o.info.UserName,request_action:"pull_account",max_id:o.urlInstagramNext};o.initNow(o.info.UserName,i)}else currentMasterIndex++,s=Math.floor(currentMasterIndex/totalRequestUrl*100),o.isSearchingForNext=!1,o.currentIndexPost=1,o.txtProgressState=0,o.eventHandler("Likes & Comments Done..."+o.info.FullName,"label-success"),_l("Current Index "+o.currentIndex),_l("totalRequestUrl "+totalRequestUrl),_l("Current% "+s),currentMasterProgress=s,stateProgress(),o.tableContentWrapper.append(o.buildViews())})},$document.ready(function(){$("input[name='info-toggle']").on("change",function(){chkOpt=$(this).val(),Config.setItem("infoFullMin",chkOpt)}),$("[data-toggle=tooltip]").tooltip(),(t=jQuery).fn.flash=function(e){void 0===e?t(".container.preloader").addClass("hide"):t(".container.preloader").removeClass("hide").find(".progress-bar.progress-bar-striped").html(e)};var t;$(".wow").jQCloud([{text:"#Lovely",weight:10},{text:"#Good",weight:11},{text:"#Excellent",weight:12},{text:"#Wowmade",weight:13},{text:"#wow",weight:14},{text:"#Philadelphia",weight:15},{text:"#NewDone",weight:16},{text:"#Best",weight:17}],{shape:"elliptic",autoResize:!0,height:350});$(".oh").jQCloud([{text:"#SoBad",weight:21},{text:"#Nope",weight:22},{text:"#DoNotWorks",weight:23},{text:"#Useless",weight:24},{text:"#SoPoor",weight:25},{text:"#AnotherBad",weight:26},{text:"#ServiceOff",weight:27},{text:"#Ban",weight:28}],{colors:["#800026","#bd0026","#e31a1c","#fc4e2a","#fd8d3c"],shape:"elliptic",autoResize:!0,height:350});var e=function(){};e.prototype.setOfflineMode=function(){if(this.userAgentStatus==fasle){var t=$("#offline-template").html();$(".wrapper").html(t)}},$(document).on("click","a.download",function(){_l("Download triggered....");var t=$(this),e=fnExcelReport(t.data("id"));t.attr("download","ExcelExport-"+(new Date).getTime()+".xls").attr("href",e).attr("target","_blank")});var o=$(Config.getItem("txtSearch"));o.typeahead({multiple:!0,source:keyContainer,autoSelect:!0,minLength:0,items:20,showHintOnFocus:!0,dupChecker:!0}),o.change(function(){var t=o.typeahead("getActive");t&&(t.name,o.val())}),$document.ajaxStart(function(){$("body").flash("Please wait...request in progress")}).ajaxStop(function(){$("body").flash()}),booClose.modal("hide"),$("body").tooltip({selector:"[rel=tooltip]",trigger:"hover"}),$document.delegate('*[data-toggle="lightbox"]',"click",function(t){t.preventDefault(),$(this).ekkoLightbox()});function n(){return"#"+("000000"+(16777215-Math.floor(16777216*Math.random())).toString(16)).substr(-6)}function s(t){(new Date).getTime();CanvasJS.addColorSet("customColorSet",[n(),n(),n(),n(),n(),n()]),new CanvasJS.Chart(t.chartId,{animationDuration:800,animationEnabled:!0,backgroundColor:"transparent",colorSet:"customColorSet",theme:"theme2",legend:{fontFamily:"calibri",fontSize:14,horizontalAlign:"left",verticalAlign:"center",itemTextFormatter:function(t){return t.dataPoint.name+": "+t.dataPoint.y}},title:{dockInsidePlotArea:!0,fontSize:20,fontWeight:"normal",horizontalAlign:"center",verticalAlign:"center",text:t.count},toolTip:{cornerRadius:0,fontStyle:"normal"},data:[{innerRadius:"80%",radius:"90%",legendMarkerType:"square",showInLegend:!0,startAngle:90,type:"doughnut",dataPoints:[{y:t.likes,name:"Likes"},{y:t.comments,name:"Comments"},{y:t.keywords,name:"Keywords"}]}]}).render(),is_chart_created=!0}$.sum=function(t){var e=0;return $.each(t,function(t,o){e+=o}),e};var i=function(t){return this.filterKeywords=t.filterKeywords,this.keyWordsGroupCountValue=[],this.container=t.container||!1,this.keyword=t.keyword||!1,this.template=t.template||!1,this.callback=t.callback||!1,this.viewData={},this.chartOptions={},this.sumOfTotalLikes=t.sumOfTotalLikes,this.sumOfTotalComments=t.sumOfTotalComments,this.sumOfTotalShare=t.sumOfTotalShare,this.sumOfTotalPosts=t.sumOfTotalPosts,this.src="",this.caption="",this.like=0,this.comment=0,this.name="",this.count=0,this.tblSummery=[],this.keywordSummery=[],this.imgSrcTemplate=[],this.setIndex=0,this.requestUrl=Config.getItem("urlRequest"),this.dataJson={},this.isNextOn=!1,this.sumOfCount=0,this.sumOfLikes=0,this.sumOfPosts=0,this.sumOfComments=0,this._self=this,this.nextId=!1,this.maxRequestNo=4,this.requestRecursiveCycle=!0,this.limitRequest=0,this.action=t.action?t.action:"pull_hashtag",this};i.prototype.initStart=function(){var t=this;return $.post(t.requestUrl,{keyword:t.keyword,next:t.nextId,request_action:t.action},function(e){if(window._sharedData.error)return!1;e=window._sharedData.entry_data.ProfilePage.shift(),_l(e),t.dataJson=e,!0===t.dataJson.graphql.hashtag.edge_hashtag_to_media.page_info.has_next_page?(t.isNextOn=!0,t.nextId=t.dataJson.graphql.hashtag.edge_hashtag_to_media.page_info.end_cursor):t.isNextOn=!1,_l(e),t.buildMediaPost(e),t.limitRequest<1&&t.buildTopPostMedia(e),t.onCallNextRequest()})},i.prototype.findHashtags=function(t){if(t){return result=t.match(/\B\#\w\w+\b/g),result||[]}return[]},i.prototype.keyWordsGroupCount=function(t){var e=this;t.forEach(function(t,o){e.keyWordsGroupCountValue[t]?e.keyWordsGroupCountValue[t].push(1):e.keyWordsGroupCountValue[t]=[1]})},i.prototype.buildTemplateView=function(){var t=this,e="chart-view-"+(new Date).getTime();this.keyWordsGroupCount(keyContainer);var o=1,n=[];Object.keys(this.keyWordsGroupCountValue.sort()).forEach(function(t,e){n.push({name:t,val:this.keyWordsGroupCountValue[t].length})},this),n.sort(function(t,e){return e.val-t.val}),n.forEach(function(e,n){t.keywordSummery.push({sno:o++,keyword:e.name,key_count:e.val})},this),this.viewData={container:e,title:this.name,"table-summery":this.tblSummery,"key-table-summery":this.keywordSummery,"img-thumbs":this.imgSrcTemplate},this.container.append(Mustache.render(this.template,this.viewData)),this.chartOptions={chartId:e,count:this.count,likes:this.like,comments:this.comment,keywords:Object.keys(this.keyWordsGroupCountValue).length}},i.prototype.buildMediaPost=function(t){var e=this;e.name=t.graphql.hashtag.name,e.count=t.graphql.hashtag.edge_hashtag_to_media.count,e.sumOfCount+=parseInt(e.count)||0,$.each(t.graphql.hashtag.edge_hashtag_to_media.edges,function(t,o){e.src=o.node.thumbnail_src,e.caption="N/A",o.node.edge_media_to_caption.edges.length&&(e.caption=o.node.edge_media_to_caption.edges[0].node.text),e.comment+=parseInt(o.node.edge_media_to_comment.count)||0,e.like+=parseInt(o.node.edge_liked_by.count)||0,e.findHashtags(e.caption).forEach(function(t){e.filterKeywords.push(t)},this)})},i.prototype.buildTopPostMedia=function(t){var e=this;$.each(t.graphql.hashtag.edge_hashtag_to_top_posts.edges,function(t,o){var n=t+1;e.src=o.node.thumbnail_src,e.caption="N/A",o.node.edge_media_to_caption.edges.length&&(e.caption=o.node.edge_media_to_caption.edges[0].node.text),e.comment+=parseInt(o.node.edge_media_to_comment.count)||0,e.like+=parseInt(o.node.edge_liked_by.count)||0,e.findHashtags(e.caption).forEach(function(t){e.filterKeywords.push(t)},this),!0===o.node.is_video?e.imgSrcTemplate.push({img_src:e.src,likes_img:o.node.edge_liked_by.count,comments_img:o.node.edge_media_to_comment.count,video_views:parseInt(o.node.video_view_count)||0}):e.imgSrcTemplate.push({img_src:o.node.thumbnail_src,likes_img:o.node.edge_liked_by.count,comments_img:o.node.edge_media_to_comment.count}),e.tblSummery.push({no:n,posts:e.caption,likes_count:o.node.edge_liked_by.count,comments_count:o.node.edge_media_to_comment.count})})},i.prototype.buildSummarizeCount=function(t){this.sumOfLikes+=this.like,this.sumOfComments+=this.comment,this.sumOfCount+=this.count,this.sumOfPosts+=this.count,this.sumOfTotalLikes.text(parseInt(this.sumOfTotalLikes.text())+this.sumOfLikes),this.sumOfTotalComments.text(parseInt(this.sumOfTotalComments.text())+this.sumOfComments),this.sumOfTotalShare.text(parseInt(this.sumOfTotalShare.text())+Object.keys(this.keyWordsGroupCountValue).length),this.sumOfTotalPosts.text(parseInt(this.sumOfTotalPosts.text())+this.sumOfPosts)},i.prototype.onCallNextRequest=function(){this.limitRequest++,this.isNextOn&&this.requestRecursiveCycle&&this.limitRequest<this.maxRequestNo?this.initStart():(this.buildTemplateView(),this.buildSummarizeCount(),this.callback(this.chartOptions))};new e;var a=parseInt(Config.getItem("queryHashtags"))-1,r=parseInt(Config.getItem("queryAccounts"))-1;$(Config.getItem("btnSearch")).click(function(t){var o=$(Config.getItem("queryFormTemplate")).html();Mustache.parse(o);var n=$(Config.getItem("searchFormContainer")),l=$(Config.getItem("txtSearch")).val();if(l){new e;var h,u=l.split(" "),c=0;$.each(u,function(t,e){if(0===u[t].indexOf("#")){h=Mustache.render(o,{action:"hashtag",value:e,indicator:"txt-progress-none",input_action:"txt-insta-none",user_indicator:"user-info-none"}),n.append(h),a++;var l={filterKeywords:keyContainer,sumOfTotalLikes:$(Config.getItem("lblSumOfTotalLikes")),sumOfTotalComments:$(Config.getItem("lblSumOfTotalComments")),sumOfTotalShare:$(Config.getItem("lblSumOfTotalShare")),sumOfTotalPosts:$(Config.getItem("lblSumOfTotalPosts")),container:$(Config.getItem("searchFormChartContainer")),keyword:e.replace("#","")||"digitaslbi",template:$(Config.getItem("chartTemplate")).html(),action:"pull_hashtag",callback:s};new i(l).initStart()}if(0===u[t].indexOf("@")){if(h=Mustache.render(o,{action:"instagram",value:e,indicator:"txt-progress",input_action:"txt-insta",user_indicator:"user-info"}),n.append(h),r++,!is_online)return void alert(Config.getItem("offlineMsg"));if($.trim(e)){e=e.replace(/\@/,"",e),isFilter=!0;var d=new Instagram;d.currentIndex=c,d.eventHandler("Getting data, please wait...."),d.initNow(null,{keyword:e,request_action:"pull_account",next:"false"}).done(function(t){d.stateError&&(d.currentIndexPost=1,d.eventHandler("Error in Instagram profile link, wrong link","label-danger"))})}c++}}),Config.setItem("queryHashtags",a),Config.setItem("queryAccounts",r),$(Config.getItem("lblCountSearchHashtags")).html(a),$(Config.getItem("lblCountSearchAccounts")).html(r)}})});