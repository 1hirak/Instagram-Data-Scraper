function fnExcelReport(t){var e=document.getElementById(t),n="<table border='2px'>";for(j=0;j<1;j++)n+="<tr bgcolor='#87AFC6'>"+e.rows[j].innerHTML+"</tr>";for(j=1;j<e.rows.length;j++)n+="<tr>"+e.rows[j].innerHTML+"</tr>";return n+="</table>",n=n.replace(/<A[^>]*>|<\/A>/g,""),n=n.replace(/<img[^>]*>/gi,""),n=n.replace(/<input[^>]*>|<\/input>/gi,""),"data:application/vnd.ms-excel, "+encodeURIComponent(n)}$=jQuery;var $document=$(document),is_online=window.navigator.onLine,htaccess=$.trim($("#htaccess").val()),$btnExportExcel=$("#btnExport"),$loadingContainer=$(".progress-bar"),totalRequestUrl=0,currentMasterIndex=1,currentMasterProgress=0,logInfo=!1,isFilter=!1,htaccess=$.trim($("#is_htaccess_enable").val()),is_chart_created=!1,navBarForm=$(".form-inline"),booClose=$(".close"),keyContainer=["#digitaslbi"],currentIndex=0,chkOpt=$("input[name='infoopt']:checked").val(),Config={action:"account",infoFullMin:chkOpt,urlRequest:"includes/AjaxServices.php",userAgentStatus:is_online,btnSearch:"#btnSearch",txtSearch:"#txtSearch",queryFormTemplate:"#query-form-template",searchFormContainer:"#search-form-section",searchFormChartContainer:"#search-form-chart-section",lblCountSearchAccounts:"#CountSearchAccounts .badge.badge-pill",lblCountSearchHashtags:"#CountSearchHashtags .badge.badge-pill",lblSumOfTotalLikes:"#SumOfTotalLikes .badge.badge-pill",lblSumOfTotalComments:"#SumOfTotalComments .badge.badge-pill",lblSumOfTotalShare:"#SumOfTotalShare .badge.badge-pill",lblSumOfTotalPosts:"#SumOfTotalPosts .badge.badge-pill",chartTemplate:"#chart-template",offlineMsg:"Please enable Internet Connection. You are off-line",queryAccounts:1,queryHashtags:1,queryLikes:1,queryComments:1,queryKeywords:1,queryPosts:1,getItem:function(t){return this[t].toString()?(_l("Item found: "+t),this[t].toString()):(_l("Item not found: "+t),!1)},setItem:function(t,e){this[t]&&(_l("Item found and set value: "+t+" : "+e),this[t]=e)}},_l=function(t){!0===logInfo&&console.log(t)};$(document).ajaxError(function(t,e,n,o){errStr="",errStr+='<div class="alert alert-danger alert-dismissable">',errStr+='  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>',errStr+="  <strong>Error in Request: </strong> "+o,errStr+="</div>",$(".error-handling .container-fluid").html(errStr).parent().removeClass("hide")});var stateProgress=function(){_l("currentMasterIndex: "+currentMasterIndex),_l("currentMasterProgress: "+currentMasterProgress)},Instagram=function(){this.stateError=!1,this.txtProgressState=0,this.info=[],this.urlInstagram="https://www.instagram.com",this.urlInstagramNext=null,this.InstaJSON=null,this.currentIndex=0,this.currentIndexPost=0,this.isSearchingForNext=!1,this.errorContainer=$(".user-error"),this.infoContainer=$(".user-info"),this.tableWrapper=$("#search-account-table"),this.tableContentWrapper=$("#search-account-table.table-striped tbody"),this.txtIndicator=$(".txt-progress"),this.sendRequestUrl=Config.getItem("urlRequest"),this.infoFullMin=Config.getItem("infoFullMin")};Instagram.prototype.setAccount=function(){if(!1===this.isSearchingForNext&&(this.info=[],this.info.Biography=this.InstaJSON.user.biography,this.info.UserName=this.InstaJSON.user.username,this.info.FullName=this.InstaJSON.user.full_name,this.info.Posts=this.InstaJSON.user.media.count,this.info.Followers=this.InstaJSON.user.followed_by.count,this.info.Following=this.InstaJSON.user.follows.count,this.info.AccountHref=this.urlInstagram+"/"+this.InstaJSON.user.username),"min"!=this.infoFullMin){var t=Math.ceil(this.info.Posts/12);this.eventHandler("Likes & Comments: "+this.currentIndexPost+"/"+t+", "+this.info.FullName),this.txtProgressState=Math.ceil(100*this.currentIndexPost)/t;var e=this.InstaJSON.user.media.nodes,n=[],o=[],s=[],i=0,a=0,r=0;$.each(e,function(t,e){n.push(e.likes.count),o.push(e.comments.count),s.push(e.video_views?e.video_views:0)}),$.each(n,function(){i+=parseInt(this)||0}),$.each(o,function(){a+=parseInt(this)||0}),$.each(s,function(){r+=parseInt(this)||0}),!1===this.isSearchingForNext?(this.info.TotalLikes=i,this.info.TotalComments=a,this.info.TotalViews=r):(this.info.TotalLikes=parseInt(this.info.TotalLikes)+i,this.info.TotalComments=parseInt(this.info.TotalComments)+a,this.info.TotalViews=parseInt(this.info.TotalViews)+r),!0===this.InstaJSON.user.media.page_info.has_next_page?(this.urlInstagramNext=e[e.length-1].id,this.currentIndexPost+=1,this.isSearchingForNext=!0):(this.currentIndexPost=1,this.isSearchingForNext=!1)}void 0===this.info.TotalLikes&&(this.info.TotalLikes=0),void 0===this.info.TotalComments&&(this.info.TotalComments=0),void 0===this.info.TotalViews&&(this.info.TotalViews=0)},Instagram.prototype.buildViews=function(){var t="";return t+='<tr class="info-row">',t+='<td><input class="tbl-chk" type="checkbox"></td>',t+='<td><a target="_blank" href="'+this.info.AccountHref+'">'+this.info.UserName+"</a></td>",t+="<td>"+this.info.Biography+"</td>",t+="<td>"+this.info.Followers+"</td>",t+="<td>"+this.info.Following+"</td>",t+="<td>"+this.info.Posts+"</td>",t+="<td>"+this.info.TotalLikes+"</td>",t+="<td>"+this.info.TotalComments+"</td>",t+="<td>"+this.info.TotalViews+"</td>",t+="<td>",t+='<a data-placement="top" data-toggle="tooltip" title="Edit">',t+='<button class="btn btn-primary btn-xs" data-title="Edit" data-toggle="modal" data-target="#edit"><span class="glyphicon glyphicon-pencil"></span></button>',t+="</a> ",t+='<a data-placement="top" data-toggle="tooltip" title="Delete">',t+='<button class="btn btn-danger btn-xs" data-title="Delete" data-toggle="modal" data-target="#delete"><span class="glyphicon glyphicon-trash"></span></button>',t+="</a>",t+="</td>",t+="</tr>"},Instagram.prototype.errorHandler=function(t){this.errorContainer.html(t)},Instagram.prototype.eventHandler=function(t,e){void 0===e?(this.txtIndicator.eq(this.currentIndex).css({width:this.txtProgressState+"%","border-top":"2px solid green"}),this.infoContainer.eq(this.currentIndex).html(t)):(this.txtIndicator.eq(this.currentIndex).css({width:this.txtProgressState+"%","border-top":"2px solid red"}),this.infoContainer.eq(this.currentIndex).removeClass("label-info").addClass(e).html(t))},Instagram.prototype.initNow=function(t,e){var n=this;return e||(e={iUrl:t,request_action:"pull_account"}),$.post(n.sendRequestUrl,e,function(t,e,o){var s=0;if(window._sharedData.error)return n.stateError=!0,n.errorHandler(window._sharedData.error),s=Math.floor(currentMasterIndex/totalRequestUrl*100),currentMasterProgress=s,stateProgress(),currentMasterIndex++,!1;if(n.InstaJSON=window._sharedData.entry_data.ProfilePage.shift(),!0===n.InstaJSON.user.is_private)return n.eventHandler("This is Private account: "+n.InstaJSON.user.full_name,"label-danger"),!1;if(n.stateError=!1,n.setAccount(),!0===n.isSearchingForNext){var i={keyword:n.info.UserName,request_action:"pull_account",max_id:n.urlInstagramNext};n.initNow(n.info.UserName,i)}else currentMasterIndex++,s=Math.floor(currentMasterIndex/totalRequestUrl*100),n.isSearchingForNext=!1,n.currentIndexPost=1,n.txtProgressState=0,n.eventHandler("Likes & Comments Done..."+n.info.FullName,"label-success"),_l("Current Index "+n.currentIndex),_l("totalRequestUrl "+totalRequestUrl),_l("Current% "+s),currentMasterProgress=s,stateProgress(),n.tableContentWrapper.append(n.buildViews())})},$document.ready(function(){function t(){return"#"+("000000"+(16777215-Math.floor(16777216*Math.random())).toString(16)).substr(-6)}function e(e){(new Date).getTime();CanvasJS.addColorSet("customColorSet",[t(),t(),t(),t(),t(),t()]),new CanvasJS.Chart(e.chartId,{animationDuration:800,animationEnabled:!0,backgroundColor:"transparent",colorSet:"customColorSet",theme:"theme2",legend:{fontFamily:"calibri",fontSize:14,horizontalAlign:"left",verticalAlign:"center",itemTextFormatter:function(t){return t.dataPoint.name+": "+t.dataPoint.y}},title:{dockInsidePlotArea:!0,fontSize:20,fontWeight:"normal",horizontalAlign:"center",verticalAlign:"center",text:e.count},toolTip:{cornerRadius:0,fontStyle:"normal"},data:[{innerRadius:"80%",radius:"90%",legendMarkerType:"square",showInLegend:!0,startAngle:90,type:"doughnut",dataPoints:[{y:e.likes,name:"Likes"},{y:e.comments,name:"Comments"},{y:e.keywords,name:"Keywords"}]}]}).render(),is_chart_created=!0}$("input[name='infoopt']").on("change",function(){chkOpt=$(this).val(),Config.setItem("infoFullMin",chkOpt)}),$("[data-toggle=tooltip]").tooltip(),function(t){t.fn.flash=function(e){void 0===e?t(".container.preloader").addClass("hide"):t(".container.preloader").removeClass("hide").find(".progress-bar.progress-bar-striped").html(e)}}(jQuery);var n=[{text:"#Lovely",weight:10},{text:"#Good",weight:11},{text:"#Excellent",weight:12},{text:"#Wowmade",weight:13},{text:"#wow",weight:14},{text:"#Philadelphia",weight:15},{text:"#NewDone",weight:16},{text:"#Best",weight:17}];$(".wow").jQCloud(n,{shape:"elliptic",autoResize:!0,height:350});var o=[{text:"#SoBad",weight:21},{text:"#Nope",weight:22},{text:"#DoNotWorks",weight:23},{text:"#Useless",weight:24},{text:"#SoPoor",weight:25},{text:"#AnotherBad",weight:26},{text:"#ServiceOff",weight:27},{text:"#Ban",weight:28}];$(".oh").jQCloud(o,{colors:["#800026","#bd0026","#e31a1c","#fc4e2a","#fd8d3c"],shape:"elliptic",autoResize:!0,height:350});var s=function(){};s.prototype.setOfflineMode=function(){if(this.userAgentStatus==fasle){var t=$("#offline-template").html();$(".wrapper").html(t)}},$(document).on("click","a.download",function(){_l("Download triggered....");var t=$(this),e=fnExcelReport(t.data("id"));t.attr("download","ExcelExport-"+(new Date).getTime()+".xls").attr("href",e).attr("target","_blank")});var i=$(Config.getItem("txtSearch"));i.typeahead({multiple:!0,source:keyContainer,autoSelect:!0,minLength:0,items:20,showHintOnFocus:!0,dupChecker:!0}),i.change(function(){var t=i.typeahead("getActive");t&&(t.name,i.val())}),$document.ajaxStart(function(){$("body").flash("Please wait...request in progress")}).ajaxStop(function(){$("body").flash()}),booClose.modal("hide"),$("body").tooltip({selector:"[rel=tooltip]",trigger:"hover"}),$document.delegate('*[data-toggle="lightbox"]',"click",function(t){t.preventDefault(),$(this).ekkoLightbox()}),$.sum=function(t){var e=0;return $.each(t,function(t,n){e+=n}),e};var a=function(t){return this.filterKeywords=t.filterKeywords,this.keyWordsGroupCountValue=[],this.container=t.container||!1,this.keyword=t.keyword||!1,this.template=t.template||!1,this.callback=t.callback||!1,this.viewData={},this.chartOptions={},this.sumOfTotalLikes=t.sumOfTotalLikes,this.sumOfTotalComments=t.sumOfTotalComments,this.sumOfTotalShare=t.sumOfTotalShare,this.sumOfTotalPosts=t.sumOfTotalPosts,this.src="",this.caption="",this.like=0,this.comment=0,this.name="",this.count=0,this.tblSummery=[],this.keywordSummery=[],this.imgSrcTemplate=[],this.setIndex=0,this.requestUrl=Config.getItem("urlRequest"),this.dataJson={},this.isNextOn=!1,this.sumOfCount=0,this.sumOfLikes=0,this.sumOfPosts=0,this.sumOfComments=0,this._self=this,this.nextId=!1,this.maxRequestNo=4,this.requestRecursiveCycle=!0,this.limitRequest=0,this.action=t.action?t.action:"pull_hashtag",this};a.prototype.initStart=function(){var t=this;return $.post(t.requestUrl,{keyword:t.keyword,next:t.nextId,request_action:t.action},function(e){if(window._sharedData.error)return!1;e=window._sharedData.entry_data.ProfilePage.shift(),_l(e),t.dataJson=e,!0===t.dataJson.graphql.hashtag.edge_hashtag_to_media.page_info.has_next_page?(t.isNextOn=!0,t.nextId=t.dataJson.graphql.hashtag.edge_hashtag_to_media.page_info.end_cursor):t.isNextOn=!1,_l(e),t.buildMediaPost(e),t.limitRequest<1&&t.buildTopPostMedia(e),t.onCallNextRequest()})},a.prototype.findHashtags=function(t){if(t){var e=/\B\#\w\w+\b/g;return result=t.match(e),result||[]}return[]},a.prototype.keyWordsGroupCount=function(t){var e=this;t.forEach(function(t,n){e.keyWordsGroupCountValue[t]?e.keyWordsGroupCountValue[t].push(1):e.keyWordsGroupCountValue[t]=[1]})},a.prototype.buildTemplateView=function(){var t=this,e="chart-view-"+(new Date).getTime();this.keyWordsGroupCount(keyContainer);var n=1,o=[];Object.keys(this.keyWordsGroupCountValue.sort()).forEach(function(t,e){o.push({name:t,val:this.keyWordsGroupCountValue[t].length})},this),o.sort(function(t,e){return e.val-t.val}),o.forEach(function(e,o){t.keywordSummery.push({sno:n++,keyword:e.name,key_count:e.val})},this),this.viewData={container:e,title:this.name,"table-summery":this.tblSummery,"key-table-summery":this.keywordSummery,"img-thumbs":this.imgSrcTemplate},this.container.append(Mustache.render(this.template,this.viewData)),this.chartOptions={chartId:e,count:this.count,likes:this.like,comments:this.comment,keywords:Object.keys(this.keyWordsGroupCountValue).length}},a.prototype.buildMediaPost=function(t){var e=this;e.name=t.graphql.hashtag.name,e.count=t.graphql.hashtag.edge_hashtag_to_media.count,e.sumOfCount+=parseInt(e.count)||0,$.each(t.graphql.hashtag.edge_hashtag_to_media.edges,function(t,n){e.src=n.node.thumbnail_src,e.caption="N/A",n.node.edge_media_to_caption.edges.length&&(e.caption=n.node.edge_media_to_caption.edges[0].node.text),e.comment+=parseInt(n.node.edge_media_to_comment.count)||0,e.like+=parseInt(n.node.edge_liked_by.count)||0,e.findHashtags(e.caption).forEach(function(t){e.filterKeywords.push(t)},this)})},a.prototype.buildTopPostMedia=function(t){var e=this;$.each(t.graphql.hashtag.edge_hashtag_to_top_posts.edges,function(t,n){var o=t+1;e.src=n.node.thumbnail_src,e.caption="N/A",n.node.edge_media_to_caption.edges.length&&(e.caption=n.node.edge_media_to_caption.edges[0].node.text),e.comment+=parseInt(n.node.edge_media_to_comment.count)||0,e.like+=parseInt(n.node.edge_liked_by.count)||0,e.findHashtags(e.caption).forEach(function(t){e.filterKeywords.push(t)},this),!0===n.node.is_video?e.imgSrcTemplate.push({img_src:e.src,likes_img:n.node.edge_liked_by.count,comments_img:n.node.edge_media_to_comment.count,video_views:parseInt(n.node.video_view_count)||0}):e.imgSrcTemplate.push({img_src:n.node.thumbnail_src,likes_img:n.node.edge_liked_by.count,comments_img:n.node.edge_media_to_comment.count}),e.tblSummery.push({no:o,posts:e.caption,likes_count:n.node.edge_liked_by.count,comments_count:n.node.edge_media_to_comment.count})})},a.prototype.buildSummarizeCount=function(t){this.sumOfLikes+=this.like,this.sumOfComments+=this.comment,this.sumOfCount+=this.count,this.sumOfPosts+=this.count,this.sumOfTotalLikes.text(parseInt(this.sumOfTotalLikes.text())+this.sumOfLikes),this.sumOfTotalComments.text(parseInt(this.sumOfTotalComments.text())+this.sumOfComments),this.sumOfTotalShare.text(parseInt(this.sumOfTotalShare.text())+Object.keys(this.keyWordsGroupCountValue).length),this.sumOfTotalPosts.text(parseInt(this.sumOfTotalPosts.text())+this.sumOfPosts)},a.prototype.onCallNextRequest=function(){var t=this;t.limitRequest++,t.isNextOn&&t.requestRecursiveCycle&&t.limitRequest<t.maxRequestNo?t.initStart():(t.buildTemplateView(),t.buildSummarizeCount(),t.callback(t.chartOptions))};new s;var r=parseInt(Config.getItem("queryHashtags"))-1,l=parseInt(Config.getItem("queryAccounts"))-1;$(Config.getItem("btnSearch")).click(function(t){var n=$(Config.getItem("queryFormTemplate")).html();Mustache.parse(n);var o=$(Config.getItem("searchFormContainer")),i=$(Config.getItem("txtSearch")).val();if(i){new s;var h,u=i.split(" "),c=0;$.each(u,function(t,s){if(0===u[t].indexOf("#")){h=Mustache.render(n,{action:"hashtag",value:s,indicator:"txt-progress-none",input_action:"txt-insta-none",user_indicator:"user-info-none"}),o.append(h),r++;var i={filterKeywords:keyContainer,sumOfTotalLikes:$(Config.getItem("lblSumOfTotalLikes")),sumOfTotalComments:$(Config.getItem("lblSumOfTotalComments")),sumOfTotalShare:$(Config.getItem("lblSumOfTotalShare")),sumOfTotalPosts:$(Config.getItem("lblSumOfTotalPosts")),container:$(Config.getItem("searchFormChartContainer")),keyword:s.replace("#","")||"digitaslbi",template:$(Config.getItem("chartTemplate")).html(),action:"pull_hashtag",callback:e};new a(i).initStart()}if(0===u[t].indexOf("@")){if(h=Mustache.render(n,{action:"instagram",value:s,indicator:"txt-progress",input_action:"txt-insta",user_indicator:"user-info"}),o.append(h),l++,!is_online)return void alert(Config.getItem("offlineMsg"));if($.trim(s)){s=s.replace(/\@/,"",s),isFilter=!0;var d=new Instagram;d.currentIndex=c,d.eventHandler("Getting data, please wait...."),d.initNow(null,{keyword:s,request_action:"pull_account",next:"false"}).done(function(t){d.stateError&&(d.currentIndexPost=1,d.eventHandler("Error in Instagram profile link, wrong link","label-danger"))})}c++}}),Config.setItem("queryHashtags",r),Config.setItem("queryAccounts",l),$(Config.getItem("lblCountSearchHashtags")).html(r),$(Config.getItem("lblCountSearchAccounts")).html(l)}})});