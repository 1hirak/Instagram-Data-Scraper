$=jQuery;var $document=$(document);var is_online=window.navigator.onLine;var htaccess=$.trim($("#htaccess").val());var $btnExportExcel=$("#btnExport");var $loadingContainer=$(".progress-bar");var totalRequestUrl=0;var currentMasterIndex=1;var currentMasterProgress=0;var logInfo=false;var isFilter=false;var htaccess=$.trim($("#is_htaccess_enable").val());var is_chart_created=false;var navBarForm=$(".form-inline");var booClose=$(".close");var keyContainer=["#digitaslbi"];var currentIndex=0;var chkOpt=$("input[name='info-toggle']:checked").val();var Config={action:"account",infoFullMin:chkOpt,urlRequest:"includes/AjaxServices.php",userAgentStatus:is_online,btnSearch:"#btnSearch",txtSearch:"#txtSearch",queryFormTemplate:"#query-form-template",accountThumbPopup:"#account-thumbs",searchFormContainer:"#search-form-section",searchFormChartContainer:"#search-form-chart-section",lblCountSearchAccounts:"#CountSearchAccounts .badge.badge-pill",lblCountSearchHashtags:"#CountSearchHashtags .badge.badge-pill",lblSumOfTotalLikes:"#SumOfTotalLikes .badge.badge-pill",lblSumOfTotalComments:"#SumOfTotalComments .badge.badge-pill",lblSumOfTotalShare:"#SumOfTotalShare .badge.badge-pill",lblSumOfTotalPosts:"#SumOfTotalPosts .badge.badge-pill",chartTemplate:"#chart-template",offlineMsg:"Please enable Internet Connection. You are off-line",queryAccounts:1,queryHashtags:1,queryLikes:1,queryComments:1,queryKeywords:1,queryPosts:1,getItem:function(a){if(this[a].toString()){_l("Item found: "+a);return this[a].toString()}else{_l("Item not found: "+a);return false}},setItem:function(a,b){if(this[a]){_l("Item found and set value: "+a+" : "+b);this[a]=b}}};var _l=function(a){if(logInfo===true){console.log(a)}};$(document).ajaxError(function(c,d,a,b){errStr="";errStr+='<div class="alert alert-danger alert-dismissable">';errStr+='  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>';errStr+="  <strong>Error in Request: </strong> "+b;errStr+="</div>";$(".error-handling .container-fluid").html(errStr).parent().removeClass("hide")});var stateProgress=function(){_l("currentMasterIndex: "+currentMasterIndex);_l("currentMasterProgress: "+currentMasterProgress)};function fnExcelReport(a){var d="data:application/vnd.ms-excel";var b=document.getElementById(a);var c="<table border='2px'>";for(j=0;j<1;j++){c+="<tr bgcolor='#87AFC6'>"+b.rows[j].innerHTML+"</tr>"}for(j=1;j<b.rows.length;j++){c+="<tr>"+b.rows[j].innerHTML+"</tr>"}c=c+"</table>";c=c.replace(/<A[^>]*>|<\/A>/g,"");c=c.replace(/<img[^>]*>/gi,"");c=c.replace(/<input[^>]*>|<\/input>/gi,"");return d+", "+encodeURIComponent(c)}var Instagram=function(){this.stateError=false;this.txtProgressState=0;this.info=[];this.urlInstagram="https://www.instagram.com";this.urlInstagramNext=null;this.InstaJSON=null;this.currentIndex=0;this.currentIndexPost=0;this.isSearchingForNext=false;this.errorContainer=$(".user-error");this.infoContainer=$(".user-info");this.tableWrapper=$("#search-account-table");this.tableContentWrapper=$("#search-account-table.table-striped tbody");this.txtIndicator=$(".txt-progress");this.sendRequestUrl=Config.getItem("urlRequest");this.infoFullMin=Config.getItem("infoFullMin")};Instagram.prototype.setAccount=function(){var a=this;this.info=[];this.info.Biography=this.InstaJSON.graphql.user.biography;this.info.UserName=this.InstaJSON.graphql.user.username;this.info.FullName=this.InstaJSON.graphql.user.full_name;this.info.user_id=this.InstaJSON.graphql.user.id,this.info.Posts=this.InstaJSON.graphql.user.edge_owner_to_timeline_media.count;this.info.Followers=this.InstaJSON.graphql.user.edge_followed_by.count;this.info.Following=this.InstaJSON.graphql.user.edge_follow.count;this.info.AccountHref=this.urlInstagram+"/"+this.InstaJSON.graphql.user.username;this.info.Thumbs=[]};Instagram.prototype.setMedia=function(){var e=this;var i=Math.ceil(this.info.Posts/12);this.eventHandler("Likes & Comments: "+this.currentIndexPost+"/"+i+", "+this.info.FullName);this.txtProgressState=Math.ceil(this.currentIndexPost*100)/i;var a=this.InstaJSON.data.user.edge_owner_to_timeline_media.edges,c=[],f=[],h=[],g=0,d=0,b=0;$.each(a,function(k,l){e.info.Thumbs.push({"thumb-src":l.node.thumbnail_resources[0].src,comments:l.node.edge_media_to_comment.count,likes:l.node.edge_media_preview_like.count});c.push(l.node.edge_media_preview_like.count);f.push(l.node.edge_media_to_comment.count);h.push((l.node.video_view_count)?l.node.video_view_count:0)});$.each(c,function(){g+=parseInt(this)||0});$.each(f,function(){d+=parseInt(this)||0});$.each(h,function(){b+=parseInt(this)||0});if(this.isSearchingForNext===false){this.info.TotalLikes=g;this.info.TotalComments=d;this.info.TotalViews=b}else{this.info.TotalLikes=parseInt(this.info.TotalLikes)+g;this.info.TotalComments=parseInt(this.info.TotalComments)+d;this.info.TotalViews=parseInt(this.info.TotalViews)+b}if(this.InstaJSON.data.user.edge_owner_to_timeline_media.page_info.has_next_page===true){this.urlInstagramNext=this.InstaJSON.data.user.edge_owner_to_timeline_media.page_info.end_cursor;this.currentIndexPost+=1;this.isSearchingForNext=true}else{this.currentIndexPost=1;this.isSearchingForNext=false}if(typeof this.info.TotalLikes=="undefined"){this.info.TotalLikes=0}if(typeof this.info.TotalComments=="undefined"){this.info.TotalComments=0}if(typeof this.info.TotalViews=="undefined"){this.info.TotalViews=0}};Instagram.prototype.buildViews=function(){var b="";b+='<tr class="info-row">';b+='<td><input class="tbl-chk" type="checkbox"></td>';b+='<td><a target="_blank" href="'+this.info.AccountHref+'">'+this.info.UserName+"</a></td>";b+="<td>"+this.info.Biography+"</td>";b+="<td>"+this.info.Followers+"</td>";b+="<td>"+this.info.Following+"</td>";b+="<td>"+this.info.Posts+"</td>";b+='<td><a href="#" data-toggle="modal" data-target="#thumb-'+this.info.UserName+'">'+this.info.TotalLikes+"</a></td>";b+="<td>"+this.info.TotalComments+"</td>";b+="<td>"+this.info.TotalViews+"</td>";b+="<td>";b+='<a data-placement="top" data-toggle="tooltip" title="Edit">';b+='<button class="btn btn-primary btn-xs" data-title="Edit" data-toggle="modal" data-target="#edit"><span class="glyphicon glyphicon-pencil"></span></button>';b+="</a> ";b+='<a data-placement="top" data-toggle="tooltip" title="Delete">';b+='<button class="btn btn-danger btn-xs" data-title="Delete" data-toggle="modal" data-target="#delete"><span class="glyphicon glyphicon-trash"></span></button>';b+="</a>";b+="</td>";b+="</tr>";var a=$(Config.getItem("accountThumbPopup")).html();Mustache.parse(a);rendered=Mustache.render(a,{username:this.info.UserName,"thumb-loop":this.info.Thumbs});this.tableWrapper.after(rendered);return b};Instagram.prototype.errorHandler=function(a){this.errorContainer.html(a)};Instagram.prototype.eventHandler=function(a,b){if(typeof b=="undefined"){this.txtIndicator.eq(this.currentIndex).css({width:this.txtProgressState+"%","border-top":"2px solid green"});this.infoContainer.eq(this.currentIndex).html(a)}else{this.txtIndicator.eq(this.currentIndex).css({width:this.txtProgressState+"%","border-top":"2px solid red"});this.infoContainer.eq(this.currentIndex).removeClass("label-info").addClass(b).html(a)}};Instagram.prototype.initNow=function(c,b){var d=this;var a=b;if(!a){a={iUrl:c,request_action:"pull_account"}}return $.post(d.sendRequestUrl,a,function(g,i,h){var f=0;if(window._sharedData.error){d.stateError=true;d.errorHandler(window._sharedData.error);f=Math.floor(((currentMasterIndex)/(totalRequestUrl))*100);currentMasterProgress=f;stateProgress();currentMasterIndex++;return false}d.InstaJSON=window._sharedData.entry_data.ProfilePage.shift();d.stateError=false;if(a.request_action==="pull_account"){if(d.InstaJSON.graphql.user.is_private===true){d.eventHandler("This is Private account: "+d.InstaJSON.graphql.user.full_name,"label-danger");return false}d.setAccount();var e={keyword:d.info.user_id,request_action:"pull_media"};d.initNow(d.info.UserName,e)}else{d.setMedia();if(d.isSearchingForNext===true){var e={keyword:d.info.user_id,request_action:"pull_media",max_id:d.urlInstagramNext};d.initNow(d.info.UserName,e)}else{currentMasterIndex++;f=Math.floor(((currentMasterIndex)/(totalRequestUrl))*100);d.isSearchingForNext=false;d.currentIndexPost=1;d.txtProgressState=0;d.eventHandler("Likes & Comments Done..."+d.info.FullName,"label-success");_l("Current Index "+d.currentIndex);_l("totalRequestUrl "+totalRequestUrl);_l("Current% "+f);currentMasterProgress=f;stateProgress();d.tableContentWrapper.append(d.buildViews())}}})};$document.ready(function(){$("input[name='info-toggle']").on("change",function(){chkOpt=$(this).val();Config.setItem("infoFullMin",chkOpt)});$("[data-toggle=tooltip]").tooltip();(function(q){q.fn.flash=function(r){if(typeof r==="undefined"){q(".container.preloader").addClass("hide")}else{q(".container.preloader").removeClass("hide").find(".progress-bar.progress-bar-striped").html(r)}}}(jQuery));var e=[{text:"#Lovely",weight:10},{text:"#Good",weight:11},{text:"#Excellent",weight:12},{text:"#Wowmade",weight:13},{text:"#wow",weight:14},{text:"#Philadelphia",weight:15},{text:"#NewDone",weight:16},{text:"#Best",weight:17}];$(".wow").jQCloud(e,{shape:"elliptic",autoResize:true,height:350});var c=[{text:"#SoBad",weight:21},{text:"#Nope",weight:22},{text:"#DoNotWorks",weight:23},{text:"#Useless",weight:24},{text:"#SoPoor",weight:25},{text:"#AnotherBad",weight:26},{text:"#ServiceOff",weight:27},{text:"#Ban",weight:28}];$(".oh").jQCloud(c,{colors:["#800026","#bd0026","#e31a1c","#fc4e2a","#fd8d3c"],shape:"elliptic",autoResize:true,height:350});var i=function(){};i.prototype.setOfflineMode=function(){if(this.userAgentStatus==fasle){var q=$("#offline-template").html();$(".wrapper").html(q)}};$(document).on("click","a.download",function(){_l("Download triggered....");var s=$(this);var r=s.data("id");var q=fnExcelReport(r);s.attr("download","ExcelExport-"+new Date().getTime()+".xls").attr("href",q).attr("target","_blank")});var g=$(Config.getItem("txtSearch"));g.typeahead({multiple:true,source:keyContainer,autoSelect:true,minLength:0,items:20,showHintOnFocus:true,dupChecker:true});g.change(function(){var q=g.typeahead("getActive");if(q){if(q.name==g.val()){}else{}}else{}});$document.ajaxStart(function(){$("body").flash("Please wait...request in progress")}).ajaxStop(function(){$("body").flash()});booClose.modal("hide");$("body").tooltip({selector:"[rel=tooltip]",trigger:"hover"});$document.delegate('*[data-toggle="lightbox"]',"click",function(q){q.preventDefault();$(this).ekkoLightbox()});function p(){var q=16777215-Math.floor(Math.random()*16777216);return"#"+("000000"+q.toString(16)).substr(-6)}function f(q){var r="chart_"+new Date().getTime();CanvasJS.addColorSet("customColorSet",[p(),p(),p(),p(),p(),p()]);r=new CanvasJS.Chart(q.chartId,{animationDuration:800,animationEnabled:true,backgroundColor:"transparent",colorSet:"customColorSet",theme:"theme2",legend:{fontFamily:"calibri",fontSize:14,horizontalAlign:"left",verticalAlign:"center",itemTextFormatter:function(s){return s.dataPoint.name+": "+s.dataPoint.y}},title:{dockInsidePlotArea:true,fontSize:20,fontWeight:"normal",horizontalAlign:"center",verticalAlign:"center",text:q.count},toolTip:{cornerRadius:0,fontStyle:"normal"},data:[{innerRadius:"80%",radius:"90%",legendMarkerType:"square",showInLegend:true,startAngle:90,type:"doughnut",dataPoints:[{y:q.likes,name:"Likes"},{y:q.comments,name:"Comments"},{y:q.keywords,name:"Keywords"}]}]});r.render();is_chart_created=true}function l(q){if(typeof q!=="undefined"){if($(window).outerWidth()>=1920){q.options.legend.fontSize=14;q.options.legend.horizontalAlign="left";q.options.legend.verticalAlign="center";q.options.legend.maxWidth=null}else{if($(window).outerWidth()<1920&&$(window).outerWidth()>=1200){q.options.legend.fontSize=14;q.options.legend.horizontalAlign="left";q.options.legend.verticalAlign="center";q.options.legend.maxWidth=140}else{if($(window).outerWidth()<1200&&$(window).outerWidth()>=992){q.options.legend.fontSize=12;q.options.legend.horizontalAlign="center";q.options.legend.verticalAlign="top";q.options.legend.maxWidth=null}else{if($(window).outerWidth()<992){q.options.legend.fontSize=14;q.options.legend.horizontalAlign="center";q.options.legend.verticalAlign="bottom";q.options.legend.maxWidth=null}}}}q.render()}}function o(){keyContainer=keyContainer.filter(a);return keyContainer}function a(s,r,q){return q.indexOf(s)===r}function n(){if(is_chart_created===true){for(var q=0;q<allCharts.length;q){l(allCharts[q])}}}$.sum=function(r){var q=0;$.each(r,function(s,t){q+=t});return q};var m=function(q){this.filterKeywords=q.filterKeywords;this.keyWordsGroupCountValue=[];this.container=q.container||false;this.keyword=q.keyword||false;this.template=q.template||false;this.callback=q.callback||false;this.viewData={};this.chartOptions={};this.sumOfTotalLikes=q.sumOfTotalLikes;this.sumOfTotalComments=q.sumOfTotalComments;this.sumOfTotalShare=q.sumOfTotalShare;this.sumOfTotalPosts=q.sumOfTotalPosts;this.src="";this.caption="";this.like=0;this.comment=0;this.name="";this.count=0;this.tblSummery=[];this.keywordSummery=[];this.imgSrcTemplate=[];this.setIndex=0;this.requestUrl=Config.getItem("urlRequest");this.dataJson={};this.isNextOn=false;this.sumOfCount=0;this.sumOfLikes=0;this.sumOfPosts=0;this.sumOfComments=0;this._self=this;this.nextId=false;this.maxRequestNo=4;this.requestRecursiveCycle=true;this.limitRequest=0;this.action=q.action?q.action:"pull_hashtag";return this};m.prototype.initStart=function(){var q=this;return $.post(q.requestUrl,{keyword:q.keyword,next:q.nextId,request_action:q.action},function(r){if(window._sharedData.error){return false}else{r=window._sharedData.entry_data.ProfilePage.shift()}_l(r);q.dataJson=r;if(q.dataJson.graphql.hashtag.edge_hashtag_to_media.page_info.has_next_page===true){q.isNextOn=true;q.nextId=q.dataJson.graphql.hashtag.edge_hashtag_to_media.page_info.end_cursor}else{q.isNextOn=false}_l(r);q.buildMediaPost(r);if(q.limitRequest<1){q.buildTopPostMedia(r)}q.onCallNextRequest()})};m.prototype.findHashtags=function d(t){if(!t){return[]}var u="#";var q="a-zÀ-ÖØ-öø-ÿĀ-ɏɓ-ɔɖ-ɗəɛɣɨɯɲʉʋʻ̀-ͯḀ-ỿЀ-ӿԀ-ԧⷠ-ⷿꙀ-֑ꚟ-ֿׁ-ׂׄ-ׇׅא-תװ-״﬒-ﬨשׁ-זּטּ-לּמּנּ-סּףּ-פּצּ-ﭏؐ-ؚؠ-ٟٮ-ۓە-ۜ۞-۪ۨ-ۯۺ-ۼۿݐ-ݿࢠࢢ-ࢬࣤ-ࣾﭐ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼก-ฺเ-๎ᄀ-ᇿ㄰-ㆅꥠ-꥿가-힯ힰ-퟿ﾡ-ￜァ-ヺー-ヾｦ-ﾟｰＡ-Ｚａ-ｚぁ-ゖ゙-ゞ㐀-䶿一-鿿꜀-뜿띀-렟-﨟〃々〻";var v="0-9０-９";var r="_";var s=new RegExp("(?:^|[^"+q+v+r+"]+)["+u+"](["+q+v+r+"]*["+q+"]+["+q+v+r+"]*)(?!["+u+q+v+r+"]+)","g");result=t.match(s);if(!result){return[]}res=result.map(function(w){w=w.trim().split("#");return"#"+w[1]});return res};m.prototype.keyWordsGroupCount=function(r){var q=this;r.forEach(function(t,s){if(q.keyWordsGroupCountValue[t]){q.keyWordsGroupCountValue[t].push(1)}else{q.keyWordsGroupCountValue[t]=[1]}})};m.prototype.buildTemplateView=function(){var r=this;var q="chart-view-"+new Date().getTime();this.keyWordsGroupCount(keyContainer);var t=1;var s=[];Object.keys(this.keyWordsGroupCountValue.sort()).forEach(function(v,u){s.push({name:v,val:this.keyWordsGroupCountValue[v].length})},this);s.sort(function(v,u){return u.val-v.val});s.forEach(function(v,u){r.keywordSummery.push({sno:t++,keyword:v.name,key_count:v.val})},this);this.viewData={container:q,title:this.name,"table-summery":this.tblSummery,"key-table-summery":this.keywordSummery,"img-thumbs":this.imgSrcTemplate};this.container.append(Mustache.render(this.template,this.viewData));this.chartOptions={chartId:q,count:this.count,likes:this.like,comments:this.comment,keywords:Object.keys(this.keyWordsGroupCountValue).length}};m.prototype.buildMediaPost=function(r){var q=this;q.name=r.graphql.hashtag.name;q.count=r.graphql.hashtag.edge_hashtag_to_media.count;q.sumOfCount+=parseInt(q.count)||0;$.each(r.graphql.hashtag.edge_hashtag_to_media.edges,function(s,t){q.src=t.node.thumbnail_src;q.caption="N/A";if(t.node.edge_media_to_caption.edges.length){q.caption=t.node.edge_media_to_caption.edges[0].node.text}q.comment+=parseInt(t.node.edge_media_to_comment.count)||0;q.like+=parseInt(t.node.edge_liked_by.count)||0;q.findHashtags(q.caption).forEach(function(u){q.filterKeywords.push(u)},this)})};m.prototype.buildTopPostMedia=function(r){var q=this;$.each(r.graphql.hashtag.edge_hashtag_to_top_posts.edges,function(s,u){var t=s+1;q.src=u.node.thumbnail_src;q.caption="N/A";if(u.node.edge_media_to_caption.edges.length){q.caption=u.node.edge_media_to_caption.edges[0].node.text}q.comment+=parseInt(u.node.edge_media_to_comment.count)||0;q.like+=parseInt(u.node.edge_liked_by.count)||0;q.findHashtags(q.caption).forEach(function(v){q.filterKeywords.push(v)},this);if(u.node.is_video===true){q.imgSrcTemplate.push({img_src:q.src,likes_img:u.node.edge_liked_by.count,comments_img:u.node.edge_media_to_comment.count,video_views:parseInt(u.node.video_view_count)||0})}else{q.imgSrcTemplate.push({img_src:u.node.thumbnail_src,likes_img:u.node.edge_liked_by.count,comments_img:u.node.edge_media_to_comment.count})}q.tblSummery.push({no:t,posts:q.caption,likes_count:u.node.edge_liked_by.count,comments_count:u.node.edge_media_to_comment.count})})};m.prototype.buildSummarizeCount=function(q){this.sumOfLikes+=this.like;this.sumOfComments+=this.comment;this.sumOfCount+=this.count;this.sumOfPosts+=this.count;this.sumOfTotalLikes.text(parseInt(this.sumOfTotalLikes.text())+this.sumOfLikes);this.sumOfTotalComments.text(parseInt(this.sumOfTotalComments.text())+this.sumOfComments);this.sumOfTotalShare.text(parseInt(this.sumOfTotalShare.text())+Object.keys(this.keyWordsGroupCountValue).length);this.sumOfTotalPosts.text(parseInt(this.sumOfTotalPosts.text())+this.sumOfPosts)};m.prototype.onCallNextRequest=function(){var q=this;q.limitRequest++;if(q.isNextOn&&q.requestRecursiveCycle&&q.limitRequest<q.maxRequestNo){q.initStart()}else{q.buildTemplateView();q.buildSummarizeCount();q.callback(q.chartOptions)}};var k=new i();var b=parseInt(Config.getItem("queryHashtags"))-1;var h=parseInt(Config.getItem("queryAccounts"))-1;$(Config.getItem("btnSearch")).click(function(w){var s=$(Config.getItem("queryFormTemplate")).html();Mustache.parse(s);var r=$(Config.getItem("searchFormContainer"));var t=$(Config.getItem("txtSearch")).val();if(t){var v=new i();var u=t.split(" ");var q=0;var x;$.each(u,function(z,C){if(u[z].indexOf("#")===0){x=Mustache.render(s,{action:"hashtag",value:C,indicator:"txt-progress-none",input_action:"txt-insta-none",user_indicator:"user-info-none"});r.append(x);b++;var A={filterKeywords:keyContainer,sumOfTotalLikes:$(Config.getItem("lblSumOfTotalLikes")),sumOfTotalComments:$(Config.getItem("lblSumOfTotalComments")),sumOfTotalShare:$(Config.getItem("lblSumOfTotalShare")),sumOfTotalPosts:$(Config.getItem("lblSumOfTotalPosts")),container:$(Config.getItem("searchFormChartContainer")),keyword:C.replace("#","")||"digitaslbi",template:$(Config.getItem("chartTemplate")).html(),action:"pull_hashtag",callback:f};var y=new m(A).initStart()}if(u[z].indexOf("@")===0){x=Mustache.render(s,{action:"instagram",value:C,indicator:"txt-progress",input_action:"txt-insta",user_indicator:"user-info"});r.append(x);h++;if(!is_online){alert(Config.getItem("offlineMsg"));return}if($.trim(C)){C=C.replace(/\@/,"",C);isFilter=true;var B=new Instagram();B.currentIndex=q;B.eventHandler("Getting data, please wait....");B.initNow(null,{keyword:C,request_action:"pull_account",next:"false"}).done(function(D){if(!B.stateError){}else{B.currentIndexPost=1;B.eventHandler("Error in Instagram profile link, wrong link","label-danger")}})}q++}});Config.setItem("queryHashtags",(b));Config.setItem("queryAccounts",(h));$(Config.getItem("lblCountSearchHashtags")).html(b);$(Config.getItem("lblCountSearchAccounts")).html(h)}})});